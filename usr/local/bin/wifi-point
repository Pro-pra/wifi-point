#!/bin/ash
#180918 sfs
[ ! "`iw list |egrep "* AP$"`" ] && ntf -a "Wifi-point" "Ваш wifi адаптер не поддерживает режим AP" && exit 1
x="`create_ap --list-running |wc -l`"
#echo x=$x
t1="WiFi точка доступа"
t="Раздача интернета с проводного 
(модема, WiFi) интерфейса  через WiFi
<small>Некоторые wifi поддерживают ретрансляцию
укажите 2 раза wifi-интерфейс</small>"

if [ "$x" -gt "2" ];then
    ntf -q "$t1 уже запущена" "`create_ap --list-running`
Остановить?" && wt "sudo create_ap --stop `create_ap --list-running| tail -1 |awk '{print $2}'`" 
fi

Y(){
yad --title="$t1 v.$v" \
    --text="$t" \
    --image="wireless" \
    --window-icon="/usr/share/pixmaps/wireless.svg" \
    --fixed --image-on-top --center \
    --field=gtk-help:BTN 'defaultbrowser "https://github.com/oblique/create_ap"' \
    --form \
    --field="Интернет $e2" "$2" \
	--field=:LBL '' \
    --field="WiFi интерфейс $w2" "$3" \
    --field="Имя сети (ESSID)" "$4" \
    --field="Пароль (>=8 знаков):H" "$6"\
    --field="--no-virt:CHK" "$5"\
    --field="запускать при старте системы:CHK" "$1" \
    --button="Старт"!media-play!:0 \
    --button=gtk-cancel:2  
#    --field="Доп. параметры" "${6} $7 $8 $9 $10"\
#    --XXfield="часов:NUM" "0!1..60!2!2" \
#    --XXfield="запрос пароля для возобновления работы!lock:BTN" 'bash -c "pass.sh &"'\
#    --separator='\n' 
#    | sudo passwd "$U" #>/dev/null
}
s="$HOME/.config/autostart/wifi-point.desktop"
if [ -f "$s" ] ;then
    p="TRUE `awk -FExec= '/^Exec=/ {print $2}' "$s" |sed 's/^sudo create_ap //'`"
    y="`Y $p`" || exit
else
