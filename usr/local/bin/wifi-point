#!/bin/ash
#180918 sfs
 e="`ifconfig | awk -F: '/^[a-z]/ && !/lo/ {print $1}'`"
e1="`ifconfig | awk -F: '/^[a-z]/ && !/lo/ {print $1}' |head -1`"
[ "$e" = "$e1" ] || e2="$e"

 w="`iwconfig | awk '/^[a-z]/ && !/lo/ {print $1}'`"
w1="`iwconfig | awk '/^[a-z]/ && !/lo/ {print $1}' |head -1`"
[ "$w" = "$w1" ] || w2="$w"

#e1="`echo $e |head -1`"
#echo "$e $e1" ;exit

GUI(){
yad --title="WiFi точка доступа" \
    --text="Раздача интернета с проводного \nинтерфейса (или модема) через WiFi" \
    --image="wireless" \
    --window-icon="/usr/share/pixmaps/wireless.svg" \
    --fixed --image-on-top --center \
    --field=gtk-help:BTN 'defaultbrowser "https://github.com/oblique/create_ap"' \
    --form \
    --field="Интернет $e2" "$e1" \
	--field=:LBL '' \
    --field="WiFi интерфейс $w2" "$w1" \
    --field="Имя сети (ESSID)" "wifipra" \
    --field="Пароль:H" \
    --button="Старт"!media-play!:0 \
    --button=gtk-cancel:2  
#    --XXfield="часов:NUM" "0!1..60!2!2" \
#    --XXfield="запрос пароля для возобновления работы!lock:BTN" 'bash -c "pass.sh &"'\
#    --separator='\n' 
#    | sudo passwd "$U" #>/dev/null
}
s="$HOME/.config/autostart/dpms.desktop"
#p="/home/`sfsusr`/.config/pass.conf"
#. "$p"
#echo $e
a=create_ap
y="`GUI`" || exit
wf="`echo "$y"| awk -F"|" '{print $4}'`"
#echo wf=$wf
t3="На WiFi интерфейсе '$wf' 
запущена точка доступа.
Нажмите для остановки"
`echo "$y"| awk -F"|" '{print "'$a' "$4" "$2" "$5" "$6}'` && \
    yad --notification --image=wireless --text="$t3" --command='bash -c "'$a' --stop '$wf' & kill $YAD_PID"'


exit


